<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt-br" lang="pt-br" dir="ltr">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <base href="" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="Ribamar FS" />
	<meta name="robots" content="noindex, nofollow" />
	<meta name="description" content="Servidores linux, Programação web (PHP, Joomla, CakePHP, Laravel), Programação Mobile (Phaser, PhoneGap, Monaca, Unity, etc) entre outros." />
	<meta name="generator" content="Joomla! - Open Source Content Management" />
	<title>Laravel - Controller  - RibaFS Portal</title>
	<link href="http://ribafs.org/portal/frameworks/laravel-5/tutoriais/laravel-controller.html?tmpl=component&amp;print=1&amp;layout=default" rel="canonical" />
	<link href="../../../templates/shaper_helix3/images/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
	<link href="../../../favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
	<script src="../../../media/jui/js/jquery.min.js@d40d24664a167cb951f5efaf872c4327" type="text/javascript"></script>
	<script src="../../../media/jui/js/jquery-noconflict.js@d40d24664a167cb951f5efaf872c4327" type="text/javascript"></script>
	<script src="../../../media/jui/js/jquery-migrate.min.js@d40d24664a167cb951f5efaf872c4327" type="text/javascript"></script>
	<script src="http://backup/portal/media/system/js/caption.js?d40d24664a167cb951f5efaf872c4327" type="text/javascript"></script>
	<script type="text/javascript">
jQuery(window).on('load',  function() {
				new JCaption('img.caption');
			});
	</script>
	<meta property="og:url" content="http://backup/portal/frameworks/laravel-5/tutoriais/laravel-controller.html" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Laravel - Controller " />
	<meta property="og:description" content="Controllers - Têm a responsabilidade de controlar o fluxo das informações, para as views e models. Métodos padrões de um controller, quando criado com a op..." />

   	<link rel="stylesheet" href="../../../media/jui/css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="../../../templates/shaper_helix3/css/frontend-edit.css" type="text/css" />
    <link rel="stylesheet" href="../../../templates/shaper_helix3/css/template.css" type="text/css" />
</head>
<body class="contentpane">
	<div id="system-message-container">
	</div>

	

<article class="item item-page" itemscope itemtype="http://schema.org/Article">
	<meta itemprop="inLanguage" content="pt-BR" />
	
	

	<div class="entry-header">
		<span class="post-format"><i class="fa fa-thumb-tack"></i></span>
		
					<h2 itemprop="name">
									Laravel - Controller 							</h2>
												</div>

						<div id="pop-print" class="btn hidden-print">
				<a href="laravel-controller.html#" onclick="window.print();return false;">			<span class="icon-print" aria-hidden="true"></span>
		Imprimir	</a>			</div>
				
	
	
				
	
			<div itemprop="articleBody">
		<p><strong>Controllers - Têm a responsabilidade de controlar o fluxo das informações, para as views e models.</strong><br /><br /><strong>Métodos padrões de um controller, quando criado com a opção --resource</strong><br /><br />index - lista todos os registros disponíveis<br />create - chama a view create, que é um form (create.blade.php) para adicionar um registro<br />store - armazena no banco o registro do form em create, antes validando seus campos<br />show - mosra um único registro através da view show.blade.php<br />edit - chama o form na view edit.blade.php para editar um registro<br />update - Sua função é armazenar no banco o registro alterado na view acima<br />destroy - permite excluir um registro<br /><br /><strong>Criar um controller numa pasta específica</strong><br />php artisan make:controller Painel\\PainelController<br /><br /><strong>Criar controller com esqueleto de métodos default</strong><br />php artisan make:controller SiteController --resource<br /><br />Exemplos:<br />Route::get('/', 'SiteController@index');<br /><br />public function index()(<br />{<br />    return 'Home page do site';<br />}<br /><br />Route::get('contato', 'SiteController@contato');<br /><br />public function contato()(<br />{<br />    return 'Home page de contato';<br />}<br /><br />public function index(Request $request)<br />{<br />    return view('tarefas.index');<br />}<br /><br />Criar controle e também um método<br />php artisan make:controller PhotoController --resource --model=Photo<br /><br />Route::resource('photo', 'PhotoController', ['only' =&gt; [<br />    'index', 'show'<br />]]);<br /><br />Route::resource('photo', 'PhotoController', ['except' =&gt; [<br />    'create', 'store', 'update', 'destroy'<br />]]);<br /><br />Route::put('user/{id}', 'UserController@update');<br /><br /><br /><strong>Criar um controller SiteController</strong><br /><br />Criar um método index() que chama a view:<br /><br />public function index()<br />{<br />    return view('welcome')<br />}<br /><br /><strong>Alterar o route</strong><br /><br />Route::get('/', 'SiteController@index');<br /><br /><br /><strong>Controller com Model</strong><br /><br />&lt;?php<br /><br />namespace App\Http\Controllers;<br />use DB;<br />use App\Carro;<br /><br />class ProdutosController extends Controller<br />{<br />    public function index()<br />    {<br />        // Retornar todos os registros da tabela carros<br />        $carros = Carro-&gt;get();    <br />        return view('index', ['carros' =&gt; $carros]);<br />    }<br /><br />}<br /><br /><br />namespace App\Http\Controllers;<br />use DB;<br /><br />class ProdutosController extends Controller<br />{<br />    public function index()<br />    {<br />        // Retornar todos os registros da tabela carros<br />        $carros = DB::table('carros')-&gt;get();    <br />        return view('index', ['carros' =&gt; $carros]);<br />    }<br /><br />}<br /><br /><br />//Adicionando novo registro<br />public function store(Request $request)<br />{<br />    $this-&gt;validate($request, [<br />        'name' =&gt; 'required|max:255',<br />    ]);<br /><br />    // Create The Task...<br />}<br /><br />public function store(Request $request)<br />{<br />    $this-&gt;validate($request, [<br />        'name' =&gt; 'required|max:255',<br />    ]);<br /><br />    $request-&gt;user()-&gt;tasks()-&gt;create([<br />        'name' =&gt; $request-&gt;name,<br />    ]);<br /><br />    return redirect('/tasks');<br />}<br /><br /><strong>Criando uma pasta para controllers e movendo para ela um controller</strong><br /><br />Http<br />    Painel<br />    Site<br />        SiteController.php<br /><br />Mudar o namespace do controller<br /><br />namespace App\Http\Controllers\Site;<br /><br />use App\Http\Controllers\Controller;<br /><br />Mudar o namespace nas rotas<br /><br />Route::get('/', 'Site\SiteController@index');<br /><br />Ou criar uma rota de grupo com o novo namespace<br /><br />Route::group(['namespace' =&gt; 'site'], function(){<br />    Route::get('/', 'SiteController@index');<br />    Route::get('contato', 'SiteController@contato')-&gt;middleware('auth');<br />});<br /><br />Assim todos os métodos/rotas exigem autenticação<br />public function __construct()<br />{<br />    $this-&gt;middleware('auth');<br />}<br /><br />Ou<br />Somente alguns métodos/rotas exigirão autenticação<br />    $this-&gt;middleware('auth')<br />            -&gt;only([<br />                'contato',<br />                'categoria'<br />            ]);<br /><br />Ou filtrando com except<br />    $this-&gt;middleware('auth')<br />            -&gt;except([<br />                'contato',<br />                'index'<br />            ]);<br /><br />Adicionar outro controller, adicionando seu namespace<br />public function store(Request $request, \App\User $user)<br />{<br />    <br />}<br /><br />public function index()<br />{<br />    $teste = 123;<br />    $teste2 = 132;<br />    $teste3 = 321;<br />    return view('teste', compact('teste', 'teste2', 'teste3'));<br />}<br /><br /><strong>Ao criar as views, criar pastas correspondentes às dos controllers:</strong><br /><br />painel<br />site<br /><br />    return view('site.teste', compact('teste', 'teste2', 'teste3'));<br /><br /><br /><strong>Criar formulário de cadastro</strong><br /><br />Criar nova rota (mudar para que esta seja a primeira rota)<br /><br />Route::get('produtos/testes', 'Produtos\ProdutoController@testes');<br /><br />Editar o controller e adicionar o método testes()<br /><br />Adicionar use do Model no controller:<br />use App\Models\Produto;<br /><br />Adicionar construtor<br /><br />private $produto;<br /><br />public function __construct(Produto $produto)<br />{<br />    $this-&gt;produto = $produto;<br />}<br /><br />O index muda para:<br /><br />public function index()<br />{<br />    $produtos = $this-&gt;produto-&gt;all();<br />    return view('produtos.index');<br />}<br /><br />Criar método teste<br /><br />public function testes()<br />{<br />    $prod = $this-&gt;produto;<br />    $prod-&gt;nome = 'Nome do produto';<br />    $prod-&gt;number = 123432;<br />    $prod-&gt;active = true;<br />    $prod-&gt;category = 'eletronicos';<br />    $prod-&gt;description = 'Descrição do produto';<br />    $insert = $prod-&gt;save();<br /><br />    if ($insert)<br />        return 'Inserido com sucesso';<br />    else<br />        return 'Falha ao inserir';<br />}<br /><br />Outra forma:<br /><br />    $this-&gt;produto-&gt;insert([<br />        'nome' =&gt; 'Nome do produto',<br />        'number' =&gt;<br />        ...<br />    ])<br /><br />Existem vários métodos assim: create(), <br /><br />O create é importante pois obriga a existência de uma relação de colunas a adicionar ao banco<br />A relação de campos a serem preenchidos fica no model, assim:<br /><br />protected $fillable = [<br />    'nome', 'number', 'active', 'categoty', 'description'<br />];<br /><br /><br /><strong>Update do registro 5</strong><br /><br />$prod = $this-&gt;produto-&gt;find(5);<br /><br />Debugar<br /><br />dd($prod); // Não precisa de exit<br /><br />dd($prod-&gt;nome);<br /><br />    $prod = $this-&gt;produto-&gt;find(5);<br />    $prod-&gt;nome = 'Nome Update';<br />    $prod-&gt;number = 123432;<br />    $prod-&gt;active = true;<br />    $prod-&gt;category = 'eletronicos';<br />    $prod-&gt;description = 'Descrição do produto';<br />    $update = $prod-&gt;save();<br /><br />    if ($update)<br />        return 'Atualizado com sucesso';<br />    else<br />        return 'Falha ao atualizar';<br /><br /><strong>Usamos o método save() também para atualizar</strong><br /><br />Outra forma é usando o método update() (requer lista de campos)<br /><br />    $prod = $this-&gt;produto-&gt;find(6);<br />    $prod-&gt;update([<br />        'nome' =&gt; 'Nome do produto6',<br />        'number' <br />        ...<br />    ]);<br /><br /><strong>Outro método útil para retornar por outro campo:</strong><br /><br />    $prod = $this-&gt;produto<br />            -&gt;where('nome', 'João Brito')<br />            -&gt;where('number', 123543);<br /><br />Delete<br /><br />    $prod = $this-&gt;produto-&gt;find(3)-&gt;delete();<br />ou<br />    $prod = $this-&gt;produto-&gt;find(6);<br />    $delete = $prod-&gt;delete();<br /><br />ou<br /><br />    $prod = $this-&gt;produto-&gt;find(6);<br />    $delete = $prod-&gt;destroy();<br /><br />ou<br />    $prod = $this-&gt;produto-&gt;destroy(3);<br />ou<br />    $prod = $this-&gt;produto-&gt;destroy([3,5,8]);<br /><br />ou<br />    $delete = $this-&gt;produto-&gt;where('number', 123654)-&gt;delete();<br /><br /><strong>Melhorar CSS</strong><br /><br />Criar paste template em views/produtos<br />Criar nesta pasta o arquivo template.blade.php, contendo<br /><br />&lt;table&gt;<br />    &lt;head&gt;<br />        &lt;title&gt;{{$title or 'Curso de Laravel 5.3'}}&lt;/title&gt;<br />    &lt;/head&gt;<br />    &lt;body&gt;<br />        @yield('content')<br /><br />    &lt;/body&gt;<br />&lt;/html&gt;<br /><br />Em views/produtos criar<br />index.blade.php, contendo<br /><br />@extends('produtos.templates.template')<br /><br />@section('content')<br />    &lt;table&gt;<br />        &lt;tr&gt;<br />            &lt;th&gt;Nome&lt;/th&gt;<br />            &lt;th&gt;Descrição&lt;/th&gt;<br />        &lt;/tr&gt;<br />        @foreach($produtos as $produto)<br />        &lt;tr&gt;<br />            &lt;td&gt;{{$produto-&gt;nome}}&lt;/td&gt;<br />            &lt;td&gt;{{$produto-&gt;descricao}}&lt;/td&gt;<br />        &lt;/r&gt;<br />        @endforeach<br />    &lt;/table&gt;<br /><br />@endsection<br /><br />No método index do controller podemos adicionar um título para a página:<br />    $title = 'Listagem de produtos';<br />    return view('produtos.index', compact('produtos', 'title'));<br /><br /><br />No controller, método create criar uma variável categoria, com um array com as categorias<br /><br />No método create criar também a variável $title<br /><br />&lt;form class="form" mathod="post" action="{{route('produtos.store')}}"&gt;<br />    &lt;input type="hidden" name="_token" value="{{csrf_token}}"&gt;    <br />    &lt;input type="text" name="nome" placeholder="Nome:" class="form-control"&gt;<br />    &lt;label&gt;<br />        &lt;input type="checkbox" name="active"&gt;&lt;br&gt;<br />        Ativo?<br />    &lt;/label&gt;<br />    &lt;input type="text" name="number" placeholder="Número:" class="form-control"&gt;<br />    &lt;select name="categoria" class="form-control"&gt;<br />        &lt;option value=""&gt;Escolha a categoria&lt;/option&gt;<br />        @foreach($categorias as $categoria)<br />            &lt;option&gt;{{$categoria}}&lt;/opton&gt;<br />        @endforeach<br />    &lt;/select&gt;<br />    &lt;textarea name="descricao" placeholder="Descricao" class="form-control"&gt;&lt;/textarea&gt;<br />&lt;/form&gt;<br /><br />No Laravel Todo form precisa de um campo com o token<br /><br />ou substituir o campo por<br />{!! csrf_field() !!}<br /><br />O método store<br /><br />public function store(Request $request)<br />{<br />    // Recupera todos os campos do form - $request-&gt;all();<br />}<br /><br />Para recuperar apenas alguns campos:<br /><br />    $request-&gt;only(['nome', 'number']);<br /><br />Recupererar todos, exceto alguns:<br /><br />    $request-&gt;except(['_token', 'categoria']);<br /><br /><strong>Recuperar apenas um campo</strong><br />    $request-&gt;input('nome');<br /><br />Recuperar campo pelo seu nome<br />    $request-&gt;name;<br /><br /><strong>Cadastrar os dados do form na tabela</strong><br /><br />public function store(Request $request)<br />{<br />    // Pega todos os campos do form<br />    $dataForm = $request-&gt;except('_token');<br />    <br />    // Faz o cadastro<br />    $insert = $this-&gt;product-&gt;insert($dataForm);<br /><br />    if($insert)<br />        return redirect()-&gt;route('produtos.index');<br />    else<br />        return redirect()-&gt;back(); // Volta para onde veio<br />//ou<br />    //    return redirect()-&gt;route('produtos.create'); // Volta para onde veio<br />}<br /><br /><strong>Para o avtive, que é requerido</strong><br /><br />if($dataForm['active'] == '')<br />    $dataForm['active'] = 0;<br />else<br />    $dataForm['active'] =1;<br />ou<br />    $active['dataForm'] = (!isset($dataForm['active'])) ? 0 : 1;<br /><br /><br /><strong>Validação dos dados antes de submeter o form</strong><br /><br />Validar no método store antes de inserir no banco<br /><br />As regras de validação devem ficar no model e não no controller<br /><br />Editemos o model produto e adicionemos uma variável public (também pode ser um mátodo)<br /><br />    public $rules = [<br />        'nome' =&gt; 'required|min:5|max:100',<br />        'number' =&gt; 'required|numeric',<br />        'categoria' =&gt; 'required',<br />        'descricao' =&gt; 'min:3|max:1000'<br />    ];<br /><br />Adicionar ao método store, antes de inserir:<br /><br />$this-&gt;validate($request, $this-&gt;produto-&gt;rules);<br /><br />Mostrar as mensagens de erro da validação na view create<br />Logo no início do form, abaixo da tag form<br /><br />@if(isset($errors) &amp;&amp; count($errors) &gt;0)<br />    &lt;div class="alert alert-danger"&gt;<br />        @foreach($errors-&gt;all(() as $error)<br />            &lt;p&gt;{{$error}}&lt;/p&gt;<br />        @endforeach<br />    &lt;/div&gt;<br />@endif<br /><br />Como manter os valores digitados nos campos do form após o submit?<br /><br />Em cada campo<br />... value="{{old('nome')}}"<br /><br />No método store, na validação podemos passar uma variável com as mensagens de erro<br /><br /><br />$this-&gt;validate($request, $this-&gt;produto-&gt;rules, $messages);<br /><br /><strong>Personalizando as mensagens:</strong><br /><br />$mensagens = [<br />    'nome.required' =&gt; 'Nome obrigatório',<br />    'nome.min' =&gt; "Nome com pelo menos 3 caracteres',<br />    'number.numric' =&gt; 'Number precisa ser numérico' <br />];<br /><br /><a href="https://www.youtube.com/watch?v=fPs-PlQIWaw&amp;index=6&amp;list=PLVSNL1PHDWvR3PeLXz6nvBkDhv1IQk4wP">https://www.youtube.com/watch?v=fPs-PlQIWaw&amp;index=6&amp;list=PLVSNL1PHDWvR3PeLXz6nvBkDhv1IQk4wP</a></p> 	</div>

	
	
				
	
	
	
</article>

</body>
</html>
